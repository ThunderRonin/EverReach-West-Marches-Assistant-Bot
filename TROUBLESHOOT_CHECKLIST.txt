═══════════════════════════════════════════════════════════════
    DISCORD BOT OFFLINE - TROUBLESHOOTING CHECKLIST
═══════════════════════════════════════════════════════════════

Bot Process Status: ✅ RUNNING (PID 11181)
PostgreSQL Status:  ✅ HEALTHY
Build Status:       ✅ PASSING

Issue: Bot offline in Discord despite process running
Most Likely: Token or Intents issue

═══════════════════════════════════════════════════════════════
RUN THESE CHECKS IN ORDER:
═══════════════════════════════════════════════════════════════

□ STEP 1: CHECK DISCORD DEVELOPER PORTAL INTENTS
──────────────────────────────────────────────────
1. Go to: https://discord.com/developers/applications
2. Select your application
3. Click "Bot" in left sidebar
4. Scroll to "Privileged Gateway Intents"
5. Make sure BOTH are enabled:
   □ Server Members Intent - ON
   □ Message Content Intent - ON
6. Click "Save Changes" if you toggled anything
7. If you made changes, restart bot:
   $ pkill -f "nest start" && yarn dev

═══════════════════════════════════════════════════════════════

□ STEP 2: VERIFY/RESET BOT TOKEN
──────────────────────────────────────────────────
Still in Discord Developer Portal → Bot:

1. Under "Token" section
2. Click "Reset Token"
3. Click "Yes, do it!"
4. IMMEDIATELY copy the new token

5. Update .env file:
   $ nano .env
   
6. Replace DISCORD_TOKEN line with new token:
   DISCORD_TOKEN=paste_your_new_token_here
   
7. Save and exit (Ctrl+O, Enter, Ctrl+X)

8. Restart bot:
   $ pkill -f "nest start"
   $ yarn dev

9. Watch for "logged in as" message in 10 seconds

═══════════════════════════════════════════════════════════════

□ STEP 3: RE-INVITE BOT WITH CORRECT PERMISSIONS
──────────────────────────────────────────────────
Go to Discord Developer Portal → OAuth2 → URL Generator:

1. Select SCOPES:
   □ bot
   □ applications.commands

2. Select BOT PERMISSIONS:
   □ Read Messages/View Channels
   □ Send Messages  
   □ Embed Links
   □ Use Slash Commands
   □ Send Messages in Threads
   □ Read Message History
   □ Add Reactions

3. Copy the generated URL at bottom

4. Open URL in browser

5. Select your server

6. Click "Authorize"

7. Restart bot:
   $ pkill -f "nest start"
   $ yarn dev

═══════════════════════════════════════════════════════════════

□ STEP 4: CHECK BOT LOGS FOR ERRORS
──────────────────────────────────────────────────
$ pkill -f "nest start"
$ yarn dev

Watch the output for 20 seconds.

GOOD SIGNS:
✅ "NecordModule dependencies initialized"
✅ "Discord bot logged in as YourBot#1234!"
✅ "ReadyListener ✅ Discord bot logged in"

BAD SIGNS:
❌ "Invalid token"
❌ "401 Unauthorized"
❌ "Disallowed intents"
❌ "Privileged intent"
❌ Any ERROR messages

═══════════════════════════════════════════════════════════════

□ STEP 5: VERIFY ENVIRONMENT VARIABLES
──────────────────────────────────────────────────
$ cat .env | grep -E "(DISCORD_TOKEN|DISCORD_CLIENT_ID|GUILD_ID_DEV)"

CHECK:
□ DISCORD_TOKEN starts with "MT"
□ DISCORD_TOKEN has no spaces
□ DISCORD_TOKEN is ~70 characters
□ DISCORD_CLIENT_ID is numeric (18-19 digits)
□ GUILD_ID_DEV is numeric (18-19 digits)
□ No quotes around values
□ No extra spaces

═══════════════════════════════════════════════════════════════

□ STEP 6: TEST DISCORD CONNECTION
──────────────────────────────────────────────────
Test if you can reach Discord API:

$ curl https://discord.com/api/v10/gateway

EXPECTED: {"url":"wss://gateway.discord.gg"}

If this fails → Network/firewall issue

═══════════════════════════════════════════════════════════════

□ STEP 7: FULL RESTART (NUCLEAR OPTION)
──────────────────────────────────────────────────
If nothing else works:

$ pkill -f "nest start"
$ docker-compose down
$ docker-compose up -d postgres
$ sleep 15
$ rm -rf dist node_modules/.cache
$ yarn build
$ yarn prisma:generate  
$ yarn dev

Watch for "logged in as" message.

═══════════════════════════════════════════════════════════════

MOST LIKELY FIX (90% of cases):
──────────────────────────────────────────────────
1. Go to Discord Developer Portal
2. Bot → Reset Token → Copy new token
3. Update .env with new token
4. Bot → Enable both Privileged Gateway Intents
5. Save Changes
6. pkill -f "nest start" && yarn dev
7. Wait 10 seconds
8. Check Discord - bot should be ONLINE!

═══════════════════════════════════════════════════════════════

Need more help? Check:
- docs/TROUBLESHOOTING_OFFLINE_BOT.md (detailed guide)
- docs/DISCORD_SETUP.md (setup instructions)
- docs/QUICK_START.md (quick start guide)

Current bot process: RUNNING (PID varies)
Bot should connect within 10 seconds of starting.
If it doesn't, it's almost always token or intents.

═══════════════════════════════════════════════════════════════

